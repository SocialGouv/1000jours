include:
  - project: SocialGouv/gitlab-ci-yml
    file: /autodevops.yml
    ref: v23.0.1

variables:
  AUTO_DEVOPS_KANIKO: "âœ”ï¸"
  AUTO_DEVOPS_RELEASE_AUTO: "âœ”ï¸"
  AUTO_DEVOPS_PRODUCTION_AUTO: "âœ”ï¸"
  AUTO_DEVOPS_ENABLE_KAPP: "âœ”ï¸"
  AUTO_DEVOPS_TEST_DISABLED: "ğŸ›‘"
  AUTO_DEVOPS_QUALITY_DISABLED: "ğŸ›‘"
  AUTO_DEVOPS_NOTIFY_DISABLED: "ğŸ›‘"

Lint:
  rules:
    - when: never

Build:
  rules:
    - when: never
    
Register Kaniko image:
  rules:
    - when: never

K8S Test:
  extends: .autodevops_k8s_test
  rules:
    - if: "$PRODUCTION || $RELEASE"
      when: never
    # NOTE(douglasduteil): ensure to run k8s test
    # - if: "$AUTO_DEVOPS_TEST_DISABLED"
    #  when: never
    - exists:
        - .k8s/package.json

Register strapi:
  extends: .autodevops_register_kaniko_image
  needs: []
  dependencies: []
  variables:
    CONTEXT: back/strapi
    IMAGE_NAME: les1000jours-strapi
